{% extends "base.html" %}

{% block content %}
  <div class="flex items-start justify-between gap-4">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight">Story Oracle</h1>
      <p class="mt-2 text-slate-300">Ask questions about your story. Answers are grounded in your local Codex + Timeline.</p>
    </div>
    <div class="flex gap-2">
      <a
        href="/chat/export"
        class="rounded border border-slate-700 bg-slate-900/60 px-3 py-2 text-sm hover:bg-slate-900"
        download="novel_summary.txt"
      >
        ğŸ“„ Export Summary
      </a>
      <form
        hx-post="/chat/clear"
        hx-target="#chat-thread"
        hx-swap="innerHTML"
      >
        <button class="rounded border border-slate-700 bg-slate-900/60 px-3 py-2 text-sm hover:bg-slate-900">
          Clear
        </button>
      </form>
    </div>
  </div>

  <div id="oracle-bible" class="mt-6" hx-get="/chat/bible" hx-trigger="load" hx-swap="innerHTML"></div>

  <div class="mt-6 rounded border border-slate-800 bg-slate-900/40">
    <div id="chat-thread" class="p-4" hx-get="/chat/thread" hx-trigger="load" hx-swap="innerHTML"></div>

    <div class="border-t border-slate-800 p-4">
      <form
        class="flex gap-2"
        hx-post="/chat/ask"
        hx-target="#chat-thread"
        hx-swap="innerHTML"
        hx-on::after-request="this.reset()"
      >
        <input
          name="message"
          placeholder="Ask: 'Does the timeline conflict with the magic system rules?'"
          class="flex-1 rounded border border-slate-700 bg-slate-950 px-3 py-2 text-sm"
          required
        />
        <button class="rounded bg-indigo-600 px-4 py-2 text-sm font-medium hover:bg-indigo-500" type="submit">
          Ask
        </button>
      </form>
      <div class="mt-2 text-xs text-slate-500">
        Tip: If the Oracle says â€œI donâ€™t know,â€ add the missing fact to Characters/Concepts/Acts/Events.
      </div>
    </div>
  </div>
{% endblock %}


